<!doctype html>
<html>

<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Tutoriel Flutter</title>
  <link rel="stylesheet"
    href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }

    .error {
      color: red;
    }
  </style>
</head>

<body>
  <google-codelab title="Tutoriel Flutter" id="your-first-pwapp" environment="web" feedback-link="">

    <google-codelab-step label="Bienvenue" duration="0">
      <p>Bienvenue sur ce tutoriel pour vous initier à Flutter.</p>
      <p>Dans ce tutoriel vous apprendrez à :</p>
      <ul>
        <li>Mettre en place un environnement de développement</li>
        <li>Initialiser un projet Flutter</li>
        <li>Communiquer avec une API</li>
        <li>Créer vos premières vues</li>
        <li>Utiliser les notifications</li>
        <li>Accéder au stockage du téléphone</li>
        <li>Déployer votre application sur un appareil</li>
      </ul>
      <p>Vous trouverez le code final sur GitHub à cette adresse <a
          href="https://github.com/GastonDeseineIG2I/LA2-TutorielFlutter/"
          target="_blank">https://github.com/GastonDeseineIG2I/LA2-TutorielFlutter/</a></p>
      <p>Un commit sur Git correspond à une étape de ce tutoriel, n&#39;hésitez pas à aller jeter un œil si vous êtes en
        difficulté.</p>
      <p>Nous allons utiliser cet API: <a href="http://dourlens-monchy.fr:8091/swagger-ui/#/"
          target="_blank">http://dourlens-monchy.fr:8091/swagger-ui/#/</a></p>
      <p>Ce tutoriel a comme ligne directrice la création d&#39;un journal personnel.</p>


    </google-codelab-step>

    <google-codelab-step label="Installation et mise en place de l&#39;environnement" duration="0">
      <p>Ici les instructions d&#39;installation sont pour un système d&#39;exploitation Windows.</p>
      <p>Pour un autre système d&#39;exploitation suivez les étapes sur le site officiel de Flutter: <a
          href="https://flutter.dev/docs/get-started/install"
          target="_blank">https://flutter.dev/docs/get-started/install</a> </p>
      <h2 is-upgraded><strong>Installation de Flutter SDK</strong></h2>
      <ul>
        <li>J&#39;utilise Chocolatey de Microsoft pour gérer mes applications sur Windows 10</li>
      </ul>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">choco install flutter</code></pre>
      <p>Pour une installation plus classique:</p>
      <ul>
        <li>Télécharger le Flutter SDK sur le site de Flutter et extraire le ZIP téléchargé là où vous le souhaitez</li>
        <li><strong>OU</strong></li>
      </ul>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">git clone https://github.com/flutter/flutter.git -b stable</code></pre>
      <ul>
        <li>Mettez à jour votre PATH en ajoutant le chemin complet vers <em>flutter/bin</em></li>
      </ul>
      <h2 is-upgraded><strong>Vérification de l&#39;installation</strong></h2>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">flutter doctor</code></pre>
      <p>Cette commande vérifie la bonne installation et nous donne des conseils si elle détecte un problème.</p>
      <h2 is-upgraded><strong>Installation de l&#39;IDE</strong></h2>
      <p>Android Studio ou IntelliJ sont recommandés pour Flutter.</p>
      <p>J&#39;ai utilisé Android Studio.</p>
      <p><a href="https://developer.android.com/studio" target="_blank">https://developer.android.com/studio</a></p>
      <p>Vous pourrez ajouter le plugin Flutter après avoir installé le SDK Android.</p>
      <h2 is-upgraded><strong>Installation de Android SDK</strong></h2>
      <p>Au démarrage de Android Studio passez par l &#39;«Assistant de configuration d&#39;Android Studio». </p>
      <p>Cela installe le dernier SDK Android, les outils de ligne de commande du SDK Android et les outils de
        construction du SDK Android, qui sont requis par Flutter lors du développement pour Android.</p>
      <h2 is-upgraded><strong>Initialisation de l&#39;émulateur Android</strong></h2>
      <p>Suivez les démarches sur le site de Flutter ou d&#39;Android Studio pour mettre en place un émulateur Android.
      </p>
      <p>Si vous utilisez un téléphone Android, vous pouvez utiliser ADB pour installer l&#39;application directement
        sur votre smartphone. Cela permet d&#39;utiliser l&#39;application dans des conditions réelles et cela soulagera
        votre ordinateur. </p>


    </google-codelab-step>

    <google-codelab-step label="Création de l&#39;application Flutter" duration="0">
      <p>Si vous avez fait le choix d&#39;utiliser Android Studio avec le plugin Flutter suivez ces étapes, sinon
        renseignez vous sur la façon de créer une application avec votre IDE.</p>
      <p><code>Fichier &gt; Nouveau &gt; Nouvelle application Flutter &gt; Application Flutter</code></p>
      <p>Vous pouvez ensuite suivre les étapes de création.</p>
      <p>Pour ce tutoriel j&#39;ai utilisé:</p>
      <ul>
        <li>Nom du projet : tutoriel_flutter</li>
        <li>Nom du package : ig2i.mobile.tutorielflutter</li>
      </ul>
      <p>Le fichier lancé au démarrage de l&#39;application est le fichier <strong><em>main.dart</em></strong> contenu
        dans <strong><em>/lib </em></strong></p>
      <p>Essayez de lancer votre projet fraîchement créé pour vérifier que tout se passe bien.</p>
      <p>Vous devez obtenir cet affichage :</p>
      <p class="image-container"><img alt="image-20210525201407287" style="width: 560.00px"
          src="https://lh4.googleusercontent.com/voJ2Ni19IHtADXFqEiWo6TGzUePFFV8VDJow2_AsX_gB_UO5Lok0CUhtALFmecrJM67ZYcX8uZZb6oRb4k4u4gPa9psUyKhVcFyQ6KFjZQSf2aQoLf7La8wXXvQf3lKTbKOtlSJP">
      </p>
      <p>Nous devons ajouter une permission pour accéder à Internet et ainsi utiliser l&#39;API. Du fait que l&#39;API
        est en HTTP et pas en HTTPS on doit le spécifier avec
        &#34;<em>android:usesCleartextTraffic=&#34;true</em>&#34;&#34;</p>
      <p>Pour ajouter cette permission il faut ajouter dans le fichier les informations manquantes
        <strong><em>/android/app/src/main/AndroidManifest.xml</em></strong></p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">&lt;manifest&gt;
    ...
    &lt;!-- Required to fetch data from the internet. --&gt;
&lt;uses-permission android:name=&#34;android.permission.INTERNET&#34; /&gt;
    ...
    &lt;application
        ...
        android:usesCleartextTraffic=&#34;true&#34;&gt;
        ....
    &lt;/application&gt;
&lt;/manifest&gt;</code></pre>


    </google-codelab-step>

    <google-codelab-step label="Système d&#39;authentification" duration="0">
      <p>Pour réaliser un système d&#39;authentification on a besoin de trois choses :</p>
      <ul>
        <li>Un <strong>formulaire</strong> de connexion (La vue)</li>
        <li>Un <strong>service</strong> qui permet de se mettre en relation avec l&#39;API</li>
        <li>Un <strong>modèle d&#39;utilisateur</strong> qui permettra de manipuler un objet Utilisateur</li>
      </ul>
      <p>Commençons par le modèle d&#39;utilisateur ! </p>
      <h2 is-upgraded><strong>Création d&#39;un modèle : L&#39;utilisateur</strong></h2>
      <p>On a besoin de créer une classe User qui contient des attributs et des méthodes.</p>
      <p>Nous allons donc créer le fichier <strong>/lib/models/user.model.dart</strong></p>
      <p>Nous créons la classe et nous ajoutons ensuite les attributs : </p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">class User {
  int? id;
  String? name;
  String? password;
  String? token;
}</code></pre>
      <p>On ajoute ensuite le constructeur dans la classe : </p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">User({this.id, this.name, this.password, this.token});</code></pre>
      <p>Puis nous créons deux méthodes qui nous seront utiles lors de la création de notre service. En effet l&#39;API
        utilise le format JSON, nous allons donc créer une méthode qui permet de passer d&#39;un objet Dart à un objet
        JSON et inversement.</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">  factory User.fromJson(Map&lt;String, dynamic&gt; json) {
    return User(
      id: json[&#39;id&#39;],
      name: json[&#39;name&#39;],
      password: json[&#39;password&#39;],
      token: json[&#39;token&#39;]
    );
  }

  Map&lt;String, dynamic&gt; toJson() =&gt; {
      &#39;id&#39;: id,
      &#39;name&#39;: name,
      &#39;password&#39;: password,
      &#39;token&#39;: token
  };</code></pre>
      <h2 is-upgraded><strong>Création du service de redirection</strong></h2>
      <p>On peut désormais créer le dossier <strong><em>/lib/services</em></strong> qui contiendra nos différents
        services.</p>
      <p>Nous allons ensuite créer un fichier <strong><em>locator.service.dart</em></strong> dans le dossier
        <strong><em>/lib/services</em></strong> qui contiendra le système de redirection vers le bon service. Cela nous
        permettra ensuite de gérer le mode en ligne et hors ligne.</p>
      <p>Juste avant créons ce fichier qui servira à stocker l&#39;URL de l&#39;API :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// /lib/services/const.dart

const API_URL = &#39;dourlens-monchy.fr:8091&#39;;</code></pre>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// /lib/services/locator.service.dart

import &#39;dart:async&#39;;

import &#39;package:get_it/get_it.dart&#39;;
import &#39;package:http/http.dart&#39; as http;

import &#39;const.dart&#39;;

GetIt locator = GetIt.instance;

// Fonction qui teste la réponse du serveur
Future&lt;bool&gt; ping() async {
  try {
    final response = await http.get(Uri.http(API_URL, &#39;ping&#39;)).timeout(
        new Duration(seconds: 5),
        onTimeout: () =&gt; throw new TimeoutException(&#39;TimeOut&#39;));
    return response.body == &#39;pong&#39;;
  } catch (error) {
    return false;
  }
}

// Fonction permettant d&#39;utiliser le bon service en fonction du cas de figure (Réponse de l&#39;API ou non)
setupServiceLocator() async {
  if (await ping()) {
    // locator.registerLazySingleton&lt;UserService&gt;(() =&gt; UserApiService());
  } else {
    // locator.registerLazySingleton&lt;UserService&gt;(() =&gt; UserOfflineService());
  }
}</code></pre>
      <p>Nous avons besoin du package Get_It et HTTP:</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">flutter pub add get_it
flutter pub add http</code></pre>
      <h2 is-upgraded><strong>Création d&#39;un service: Le service utilisateur</strong></h2>
      <p>Nous allons désormais créer notre premier service!</p>
      <p>Commençons par créer le dossier qui va l&#39;accueillir : <strong><em>/lib/services/user</em></strong></p>
      <p>Ce dossier va contenir trois fichier :</p>
      <ul>
        <li>La classe abstraite contenant les méthodes à implémenter :
          <strong><em>user.abstract.service.dart</em></strong></li>
        <li>La classe qui utilisera l&#39;API : <strong><em>user.api.service.dart</em></strong></li>
        <li>La classe qui prendra le relai lorsqu&#39;on n&#39;aura pas accès à l&#39;API :
          <strong><em>user.offline.service.dart</em></strong></li>
      </ul>
      <h3 is-upgraded><strong>La classe abstraite </strong></h3>
      <p>Cette classe contient toutes les méthodes à implémenter dans les classes filles.</p>
      <p>Nous avons donc :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// /lib/services/user/user.abstract.service.dart

import &#39;package:tutoriel_flutter/models/user.model.dart&#39;;

abstract class UserService {
  Future&lt;int&gt; createUser(User user);
  Future&lt;int&gt; login(User user);
  Future&lt;int&gt; logout();
  Future&lt;User&gt; getCurrentUser(User user);
}</code></pre>
      <h3 is-upgraded><strong>La classe API</strong></h3>
      <p>Cette classe contient les méthodes implémentées qui réalisent des appels à l&#39;API</p>
      <p>On va ajouter le package <em>SharedPreferences</em> qui permet d&#39;accéder au stockage de l&#39;appareil.</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">flutter pub add shared_preferences</code></pre>
      <p>On va ensuite implémenter la classe <strong>UserApiService</strong> dans
        <strong><em>user.api.service.dart</em></strong></p>
      <p>Pour effectuer une requête API en HTTP on retrouve un code de cette forme :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">final response = await http.post(
        Uri.http(API_URL, &#39;v1/authentication/login&#39;),
        headers: &lt;String, String&gt;{
          &#39;Content-Type&#39;: &#39;application/json; charset=UTF-8&#39;,
        },
        body: jsonEncode({
          &#39;username&#39;: user.name,
          &#39;password&#39;: user.password
        }
       ));</code></pre>
      <p>Voici le résultat final de cette implémentation :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// /lib/services/user/user.api.service.dart

import &#39;dart:convert&#39;;

import &#39;package:tutoriel_flutter/models/user.model.dart&#39;;
import &#39;package:tutoriel_flutter/services/user/user.abstract.service.dart&#39;;
import &#39;package:http/http.dart&#39; as http;
import &#39;package:shared_preferences/shared_preferences.dart&#39;;

import &#39;../const.dart&#39;;

class UserApiService extends UserService {
  @override
  Future&lt;int&gt; createUser(User user) async {
    print(user.toJson());
    final response = await http.post(Uri.http(API_URL, &#39;v1/users&#39;),
        headers: &lt;String, String&gt;{
          &#39;Content-Type&#39;: &#39;application/json; charset=UTF-8&#39;,
        },
        body: jsonEncode(user.toJson()));
    if (response.statusCode == 201) {
      // If the server did return a 200 OK response,
      // then parse the JSON.
      return 0;
    } else {
      // If the server did not return a 200 OK response,
      // then throw an exception.
      throw Exception(&#39;Failed to create user&#39;);
    }
  }

  @override
  Future&lt;int&gt; login(User user) async {
    final prefs = await SharedPreferences.getInstance();
    final response = await http.post(
        Uri.http(API_URL, &#39;v1/authentication/login&#39;),
        headers: &lt;String, String&gt;{
          &#39;Content-Type&#39;: &#39;application/json; charset=UTF-8&#39;,
        },
        body: jsonEncode({
          &#39;username&#39;: user.name,
          &#39;password&#39;: user.password
        }));
    if (response.statusCode == 200) {
      // If the server did return a 200 OK response,
      // then parse the JSON.
      user.id = jsonDecode(response.body)[&#39;idUser&#39;];
      user.token = jsonDecode(response.body)[&#39;token&#39;];
      prefs.setString(&#39;user&#39;, json.encode(user));
      print(prefs.getString(&#39;user&#39;));
      return 0;
    } else {
      // If the server did not return a 200 OK response,
      // then throw an exception.
      print(response.statusCode);
      print(jsonDecode(response.body));
      throw Exception(&#39;Failed to login&#39;);
    }
  }

  @override
  Future&lt;int&gt; logout() async {
    String? token;
    http.Response response;
    final prefs = await SharedPreferences.getInstance().then((value) async {
      token = value.getString(&#39;token&#39;);
      response = await http.post(Uri.http(API_URL, &#39;v1/authentication/logout&#39;),
          headers: &lt;String, String&gt;{
            &#39;Content-Type&#39;: &#39;application/json; charset=UTF-8&#39;,
            &#39;token&#39;: &#39;$token&#39;
          });

      if(response.statusCode == 200){
        return 0;
      }
      else{
        throw Exception(&#39;Failed to login&#39;);
      }
    });
    return 0;
  }

  @override
  Future&lt;User&gt; getCurrentUser(User user) {
    // TODO: implement getCurrentUser
    throw UnimplementedError();
  }

}</code></pre>
      <h3 is-upgraded><strong>La classe offline</strong></h3>
      <p>On peut maintenant créer la classe qui servira à récupérer les données hors connexion.</p>
      <p>Voici un exemple d&#39;implémentation d&#39;une des méthodes :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">class UserOfflineService extends UserService {
  @override
  Future&lt;int&gt; createUser(User user) {
    // TODO: implement createUser
    throw UnimplementedError();
  }
...
}</code></pre>
      <h3 is-upgraded><strong>Ajout des services au Locator</strong></h3>
      <p>Nous pouvons désormais ajouter notre service à notre Locator contenu dans
        <strong><em>/lib/services/locator.service.dart</em></strong></p>
      <p>Voici le nouveau contenu de la méthode <strong><em>setupServiceLocator()</em></strong></p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// /lib/services/locator.service.dart

setupServiceLocator() async {
  if (await ping()) {
    locator.registerLazySingleton&lt;UserService&gt;(() =&gt; UserApiService());
  } else {
    locator.registerLazySingleton&lt;UserService&gt;(() =&gt; UserOfflineService());
  }
}</code></pre>
      <h2 is-upgraded><strong>Création de notre vue : Le formulaire de connexion</strong></h2>
      <p>Nous allons enfin modifier notre affichage!</p>
      <p>Cette étape permet de réaliser un formulaire de connexion permettant à l&#39;utilisateur de s&#39;identifier.
      </p>
      <p>Nos vues se trouveront dans le dossier <strong><em>/lib/pages</em></strong></p>
      <p>Nous allons créer le fichier <strong><em>login.page.dart</em></strong> :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">import ...

class LoginPage extends StatefulWidget {
  LoginPage({Key? key}) : super(key: key);

  // This widget is the home page of your application. It is stateful, meaning
  // that it has a State object (defined below) that contains fields that affect
  // how it looks.

  // This class is the configuration for the state. It holds the values (in this
  // case the title) provided by the parent (in this case the App widget) and
  // used by the build method of the State. Fields in a Widget subclass are
  // always marked &#34;final&#34;.

  @override
  _LoginPageState createState() =&gt; _LoginPageState();
}

class _LoginPageState extends State&lt;LoginPage&gt; {
  late User user;

  final nameController = TextEditingController();
  final passwordController = TextEditingController();

  UserService _userService = locator&lt;UserService&gt;();

  @override
  void initState() {
    super.initState();
  }

  @override
  Widget build(BuildContext context){

    final _formKey = GlobalKey&lt;FormState&gt;();

    return Scaffold(
      appBar: AppBar(
        // Here we take the value from the MyHomePage object that was created by
        // the App.build method, and use it to set our appbar title.
        title: Text(&#39;Login&#39;),
      ),
      body: Center(
        // Center is a layout widget. It takes a single child and positions it
        // in the middle of the parent.

        child: ...
      ),
    );
  }
}</code></pre>
      <p>Voici la structure du code, essayez d&#39;y ajouter un formulaire d&#39;identification, n&#39;hésitez pas à
        vous aider de la documentation de Flutter et de mon code GitHub en cas de difficultés.</p>
      <p>On aimerait obtenir cette structure :</p>
      <p><code>Container &gt; Column &gt; Form &gt; {TextFormField; TextFormField; ElevatedButton}</code></p>
      <p>On peut désormais mettre à jour <strong><em>/lib/main.dart</em></strong> pour qu&#39;il affiche la bonne vue au
        démarrage.</p>
      <p>Pour rappel la méthode main() de ce fichier est la méthode appelée au lancement de l&#39;application. </p>
      <p>On va également réaliser un peu de ménage dans ce fichier pour supprimer la vue d&#39;exemple créé par Android
        Studio.</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// /lib/main.dart

import &#39;package:flutter/material.dart&#39;;
import &#39;package:tutoriel_flutter/pages/login.page.dart&#39;;
import &#39;package:tutoriel_flutter/services/locator.service.dart&#39;;

void main() async {
  await setupServiceLocator();
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: &#39;Tutoriel Flutter&#39;,
      theme: ThemeData(
        // This is the theme of your application.
        //
        // Try running your application with &#34;flutter run&#34;. You&#39;ll see the
        // application has a blue toolbar. Then, without quitting the app, try
        // changing the primarySwatch below to Colors.green and then invoke
        // &#34;hot reload&#34; (press &#34;r&#34; in the console where you ran &#34;flutter run&#34;,
        // or simply save your changes to &#34;hot reload&#34; in a Flutter IDE).
        // Notice that the counter didn&#39;t reset back to zero; the application
        // is not restarted.
        primarySwatch: Colors.blue,
      ),
      home: LoginPage(),
    );
  }
}</code></pre>
      <p>Essayez de relancer l&#39;application, vous devez obtenir un résultat similaire :</p>
      <p class="image-container"><img alt="image-20210526210506671" style="width: 560.00px"
          src="https://lh6.googleusercontent.com/sdpumYEyfnzpxJWqylGkIA74TZMerNod9qLG-Qw_sp6XkK4yCJKEcqDx-ApS4lK0xmcox8x47y-uTGrFGN1MbrsezY7gJsuWZHgjM7382tH7LRBJ7tInhQ2uPsT4HRA9_6ELo6p_">
      </p>


    </google-codelab-step>

    <google-codelab-step label="Notre premier affichage : Liste déroulante" duration="0">
      <p>Maintenant que nous pouvons nous authentifier nous allons pouvoir afficher des informations propres à
        l&#39;utilisateur.</p>
      <p>Nous allons afficher les topics d&#39;un utilisateur. Pour cela nous allons devoir recommencer les étapes de la
        partie précédente : </p>
      <ul>
        <li>Créer un modèle</li>
        <li>Créer un service</li>
        <li>Créer une vue</li>
      </ul>
      <h2 is-upgraded><strong>Création du modèle</strong></h2>
      <p>Nous allons créer le fichier <strong><em>topic.model.dart</em></strong> dans le dossier
        <strong><em>/lib/models/</em></strong></p>
      <p>Il contiendra les attributs qui lui sont liés et les méthodes de conversion JSON.</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">class Topic {
  int? id;
  DateTime? creationDate;
  String? name;
  User? user;
}</code></pre>
      <p>Ajoutez le constructeur et les méthodes de conversion vues plus haut.</p>
      <h2 is-upgraded><strong>Création du service</strong></h2>
      <p>Une fois de plus nous allons créer trois fichiers :</p>
      <ul>
        <li>La classe <strong>TopicService</strong> abstraite contenant les méthodes à implémenter :
          <strong><em>topic.abstract.service.dart</em></strong></li>
        <li>La classe <strong>TopicApiService</strong> qui utilisera l&#39;API :
          <strong><em>topic.api.service.dart</em></strong></li>
        <li>La classe <strong>TopicOfflineService</strong> qui prendra le relai lorsqu&#39;on n&#39;aura pas accès à
          l&#39;API : <strong><em>topic.offline.service.dart</em></strong></li>
      </ul>
      <p>Nous implémenterons ces trois méthodes:</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">Future&lt;int&gt; createTopic(Topic topic);
Future&lt;List&lt;Topic&gt;&gt; getTopics();
Future&lt;Topic&gt; getTopic(int id);</code></pre>
      <p>Pour l&#39;implémentation cela se déroule de la même manière que l&#39;implémentation des services utilisateur.
      </p>
      <p>Il faut également ajouter nos services au Locator.</p>
      <h2 is-upgraded><strong>Création de la vue</strong></h2>
      <p>Nous allons maintenant créer la vue qui affichera les topics récupérés avec le service.</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">import ...

class TopicsPage extends StatefulWidget {
  TopicsPage({Key? key}) : super(key: key);

  _TopicsPageState createState() =&gt; _TopicsPageState();

}

class _TopicsPageState extends State&lt;TopicsPage&gt; {
  late User user;

  final nameController = TextEditingController();
  final passwordController = TextEditingController();
  final List&lt;int&gt; colorCodes = &lt;int&gt;[700, 600, 500, 400];

  TopicService _topicService = locator&lt;TopicService&gt;();
  late List&lt;Topic&gt; topics;

  @override
  void initState() {
    super.initState();
  }

  _getTopics() async {
    topics = await _topicService.getTopics();
    return topics;
  }

  @override
  Widget build(BuildContext context) {
    final _formKey = GlobalKey&lt;FormState&gt;();
    return Scaffold(
      appBar: AppBar(
        // Here we take the value from the MyHomePage object that was created by
        // the App.build method, and use it to set our appbar title.
        title: Text(&#39;My Topics&#39;),
        leading: IconButton(
          icon: Icon(Icons.arrow_back),
          onPressed: () =&gt; Navigator.push(
            context,
            MaterialPageRoute(
                builder: (context) =&gt;
                    LoginPage()
            ),
          ),
        ),
      ),
      body: Center(
        // Center is a layout widget. It takes a single child and positions it
        // in the middle of the parent.

          child: Column(
              children: &lt;Widget&gt;[
                Container(
                    child: TextFormField(),
                ),
                Container(
                    child: _getTopicsView()
                ),
              ]
          )
      ),
    );
  }
}</code></pre>
      <p>On ajoute cette méthode qui génère la liste de topics.</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">Widget _getTopicsView() {
    return FutureBuilder(
        future: _getTopics(),
        builder:(context, AsyncSnapshot snapshot) {
          if (!snapshot.hasData) {
            return Center(child: CircularProgressIndicator());
          } else if (topics.isEmpty) {
            return Center(child:Text(&#39;No topics.&#39;));
          } else {
            return Container(
                child: ListView.builder(
                    padding: const EdgeInsets.all(8),
                    shrinkWrap: true,
                    itemCount: topics.length,
                    scrollDirection: Axis.vertical,
                    itemBuilder: (BuildContext context, int index) {
                      return new GestureDetector(
                        onTap: () {
                        },
                        child:  Container(
                          height: 70,
                          color: Colors.blue[colorCodes[index%4]],
                          child: Center(child: Text(&#39;${topics[index].name}&#39;)),
                        ),

                      );
                    }
                )
            );
          }
        }
    );
  }</code></pre>
      <h2 is-upgraded><strong>Relier la vue avec l&#39;application</strong></h2>
      <p>Maintenant que tout est prêt nous souhaitons afficher la vue après qu&#39;on se soit connecté.</p>
      <p>Nous allons ajouter dans le <strong>ElevatedButton</strong> de la page
        <strong><em>login.page.dart</em></strong> un évènement de redirection.</p>
      <p>On ajoute donc ce morceau de code qui permet de naviguer entre les pages:</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">Navigator.push(
    context,
    MaterialPageRoute(builder: (context) =&gt; TopicsPage()),
)</code></pre>
      <p>Vous devez à la connexion vous retrouver sur une page qui ressemble à ceci :</p>
      <p class="image-container"><img alt="image-20210526223422399" style="width: 560.00px"
          src="https://lh5.googleusercontent.com/HlcmRJANzfjJXPk25K8TERy68SWW5hbE0HLx8yPrd0zZGMBfHSPkl4Cz4kU-HV0l73H0-lY0BEQV9_LDu5o-ZcaLGpYODubRKyoH4xeJ6PrKzUWohXJUh--5o0H9E8tuwMiY0XCr">
      </p>


    </google-codelab-step>

    <google-codelab-step label="Ajouter des données : L&#39;ajout de Topic" duration="0">
      <p>Nous avons appris à afficher des données, nous allons maintenant voir pour en créer !</p>
      <p>Nous avons déjà implémenté les méthodes de création dans notre service, il nous reste seulement à créer la vue
        et à la relier au système.</p>
      <h2 is-upgraded><strong>Création de la vue</strong></h2>
      <p>Nous allons créer un formulaire permettant d&#39;ajouter un topic.</p>
      <p>Pour cela nous allons créer le fichier <strong><em>new.topic.page.dart</em></strong></p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">import ...
    
class NewTopicsPage extends StatefulWidget {
  NewTopicsPage({Key? key, required this.title}) : super(key: key);

  final String title;

  _NewTopicsPageState createState() =&gt; _NewTopicsPageState();
}

class _NewTopicsPageState extends State&lt;NewTopicsPage&gt; {
  late User user;

  final nameController = TextEditingController();

  TopicService _topicService = locator&lt;TopicService&gt;();
  late Topic topic;

  @override
  void initState() {
    super.initState();
  }

  @override
  Widget build(BuildContext context) {

    final _formKey = GlobalKey&lt;FormState&gt;();

    return Scaffold(
        appBar: AppBar(
          // Here we take the value from the MyHomePage object that was created by
          // the App.build method, and use it to set our appbar title.
          title: Text(widget.title),
        ),
        body: Center(
            child: ...
        )
    );
  }
}</code></pre>
      <p>Complétez pour obtenir un résultat sous cette forme :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">Center &gt; Container &gt; Column &gt; Form &gt; {TextFormField; ElevatedButton}</code></pre>
      <h2 is-upgraded><strong>Implantation dans le système existant</strong></h2>
      <p>Nous allons simplement ajouter un bouton permettant de créer un topic sur notre page affichant l&#39;ensemble
        des topics.</p>
      <p>Modifions donc le fichier <strong><em>topics.page.dart</em></strong></p>
      <p>Ajouter ce morceau de code juste après le container contenant <em>_getTopicsView()</em></p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr"> Container(
     child: Column(
         children: &lt;Widget&gt;[
             Row(
                 mainAxisAlignment: MainAxisAlignment.center,
                 crossAxisAlignment: CrossAxisAlignment.center,
                 children: [
                     ElevatedButton(onPressed: () =&gt; {
                         Navigator.push(
                             context,
                             MaterialPageRoute(builder: (context) =&gt; NewTopicsPage(title: &#39;New Topic&#39;)),
                         )
                     }, child: Text(&#39;New&#39;))
                 ],
             )
         ],
     ),
 )</code></pre>
      <p>Voici les nouveaux affichages :</p>
      <p class="image-container"><img alt="image-20210526225201890" style="width: 560.00px"
          src="https://lh5.googleusercontent.com/wKscwt7f5C1ap7Mjsov9A89xydFuiY5w9m5yjrKWkLfOSFl2sDGDNb5fRH3VvR9DKQ9y9N4lgGSPfplqwjvciyJgXNVzVm0KTWE5GhFQlpZAxNwxDxTlEO84BFLFFAQWqf5nb3rT">
      </p>
      <p class="image-container"><img alt="image-20210526225213631" style="width: 560.00px"
          src="https://lh5.googleusercontent.com/Zoqz2jS--DWFwK8Kyj9l8mDEnHinQmjQJSaP9em38C3a4ZFK-QGmHuwXLCtgGGSQNrCT0Y3l3pMaqHKIJYZjqJZ1CM-_T19y8AVqXtkIfNFKTIZiAKnypCnlkWDqcWReEhE0DHta">
      </p>


    </google-codelab-step>

    <google-codelab-step label="Accéder au stockage du téléphone" duration="0">
      <p>Pour accéder au stockage du téléphone nous avons utilisé le package <strong>SharedPreferences</strong></p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">flutter pub add shared_preferences</code></pre>
      <p>Pour l&#39;utiliser il faut l&#39;importer</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">import &#39;package:shared_preferences/shared_preferences.dart&#39;;</code></pre>
      <p>Puis dans une méthode on peut :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">// Récupérer l&#39;instance
final prefs = await SharedPreferences.getInstance();

// Ajouter la variable user contenant le contenu de user encodé en JSON
prefs.setString(&#39;user&#39;, json.encode(user));

// Pour récupérer la valeur
prefs.getString(&#39;user&#39;);</code></pre>


    </google-codelab-step>

    <google-codelab-step label="Les notifications" duration="0">
      <p>Les applications utilisent très souvent des notifications push pour vous avertir. </p>
      <p>Nous allons ici créer une notification simple afin de prendre en main ce système. </p>
      <h2 is-upgraded><strong>Autoriser les notifications pour Android</strong></h2>
      <p>Dans le fichier <code>android/app/src/main/AndroidManifest.xml</code> ajoutez ces différentes autorisations
        dans la balise <code>manifest</code></p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">&lt;uses-permission android:name=&#34;android.permission.RECEIVE_BOOT_COMPLETED&#34;/&gt;
&lt;uses-permission android:name=&#34;android.permission.VIBRATE&#34; /&gt;
&lt;uses-permission android:name=&#34;android.permission.WAKE_LOCK&#34; /&gt;</code></pre>
      <p>Puis ajoutez dans la balise <code>application</code> dans le même fichier la configuration de certains
        événements Android</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">&lt;receiver android:name=&#34;com.dexterous.flutterlocalnotifications.ScheduledNotificationReceiver&#34; /&gt;
&lt;receiver android:name=&#34;com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver&#34;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&#34;android.intent.action.BOOT_COMPLETED&#34;/&gt;
        &lt;action android:name=&#34;android.intent.action.MY_PACKAGE_REPLACED&#34;/&gt;
        &lt;action android:name=&#34;android.intent.action.QUICKBOOT_POWERON&#34; /&gt;
        &lt;action android:name=&#34;com.htc.intent.action.QUICKBOOT_POWERON&#34;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;</code></pre>
      <h2 is-upgraded><strong>Installation du package flutter_local_notifications</strong></h2>
      <p>Exécutez la commande ci-dessous pour ajouter le package en dépendance du projet</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">flutter pub add flutter_local_notifications</code></pre>
      <p>Ou ajoutez la directement dans le fichier <code>pubspec.yaml</code>.</p>
      <p><code>dependencies</code><strong><code>:</code></strong><br>
        <code>flutter_local_notifications</code><strong><code>:</code></strong><code> ^6.0.0</code></p>
      <p>Puis installez les dépendances avec la commande suivante</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">dart pub get</code></pre>
      <h2 is-upgraded><strong>Configuration des paramètres des notification pour Android, IOS et MacOS</strong></h2>
      <p>Dans le fichier <code>main.dart</code> ajoutez les différents paramètres/préférences pour chaque appareil en
        utilisant le package <strong><em>flutter_local_notifications</em></strong></p>
      <p>Exemple :</p>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">/// Initialisation du plugin flutter pour les notifications
final FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin = FlutterLocalNotificationsPlugin();

void main() async {

  await initNotification(); //Initialise le systeme de notification
  await setupServiceLocator();
  runApp(MyApp());
  _notify(); //Envoie une notification
}

Future initNotification() async {

  /// Attend que le WidgetsBinding soit initialisé pour pouvoir paramètrer correctement les notifications
  WidgetsFlutterBinding.ensureInitialized();

  /// Initialisation des paramètres Android
  var initializationSettingsAndroid =
  AndroidInitializationSettings(&#39;@mipmap/ic_launcher&#39;);

  /// Note: Les permissions IOS et Mac ne sont pas forcément requises ici si elles sont déjà définies.
  /// Initialisation des paramètres IOS
  final IOSInitializationSettings initializationSettingsIOS =
  IOSInitializationSettings(
      requestAlertPermission: true,
      requestBadgePermission: true,
      requestSoundPermission: true,
      onDidReceiveLocalNotification:
          (int id, String? title, String? body, String? payload) async {});
  /// Initialisation des paramètres MacOS
  const MacOSInitializationSettings initializationSettingsMacOS =
  MacOSInitializationSettings(
      requestAlertPermission: true,
      requestBadgePermission: true,
      requestSoundPermission: true);

  /// Mappage des paramètres
  final InitializationSettings initializationSettings = InitializationSettings(
      android: initializationSettingsAndroid,
      iOS: initializationSettingsIOS,
      macOS: initializationSettingsMacOS);
  /// Initialisation des paramètres
  await flutterLocalNotificationsPlugin.initialize(initializationSettings,
      onSelectNotification: (String? payload) async {});
}</code></pre>
      <h2 is-upgraded><strong>Exemple d&#39;une fonction de notification</strong></h2>
      <pre translate="no" dir="ltr"><code translate="no" dir="ltr">void _notify() async {
  /// Paramètrage Android
  var androidPlatformChannelSpecifics = AndroidNotificationDetails(
    &#39;channel_id&#39;,
    &#39;channel_name&#39;,
    &#39;channel description&#39;,
    icon: &#39;@mipmap/ic_launcher&#39;,
    largeIcon: DrawableResourceAndroidBitmap(&#39;@mipmap/ic_launcher&#39;),
    importance: Importance.max,
    priority: Priority.high,
    ticker: &#39;test_ticker&#39;
  );
  /// Paramètrage IOS
  var iOSPlatformChannelSpecifics = IOSNotificationDetails();

  var platformChannelSpecifics = NotificationDetails(
      android: androidPlatformChannelSpecifics, iOS: iOSPlatformChannelSpecifics);

  await flutterLocalNotificationsPlugin.show(0, &#39;Bienvenue !&#39;, &#39;Voici votre première notification avec Flutter !!!&#39;,
      platformChannelSpecifics);
}</code></pre>
      <p>Cela devrait vous donner ceci : </p>
      <p class="image-container"><img alt="image-20210526214220524" style="width: 560.00px"
          src="https://lh4.googleusercontent.com/oD14yB3OjIyMF0Qb-R76PO3ebvcTAT-H_lKU02C0VpvOFX3mmXEzDDnfWUptYtN6EzCPdVtHTslGIRZdumPfSi04s00XVZDrhIU_hQ-laGdOnQ-I4UU6ksRHKZv6WQu4BQU7JSBO">
      </p>


    </google-codelab-step>

    <google-codelab-step label="Déploiement de l&#39;application" duration="0">
      <p>Pour déployer l&#39;application il faut suivre ce tutoriel présent sur le site de Flutter: <a
          href="https://flutter.dev/docs/deployment/android"
          target="_blank">https://flutter.dev/docs/deployment/android</a></p>
      <h2 is-upgraded><strong>Build un APK</strong></h2>
      <ol type="1" start="1">
        <li>Taper <code>cd [project]</code></li>
        <li>Lancez <code>flutter build apk --split-per-abi</code></li>
      </ol>
      <p>Cette commande génère trois fichiers APK:</p>
      <ul>
        <li><code>[project]/build/app/outputs/apk/release/app-armeabi-v7a-release.apk</code></li>
        <li><code>[project]/build/app/outputs/apk/release/app-arm64-v8a-release.apk</code></li>
        <li><code>[project]/build/app/outputs/apk/release/app-x86_64-release.apk</code></li>
      </ul>
      <h2 is-upgraded><strong>Installer un APK sur un appareil</strong></h2>
      <p>Suivez ces étapes pour installer l&#39;APK sur un appareil Android connecté.</p>
      <p>Depuis la ligne de commande:</p>
      <ol type="1" start="1">
        <li>Connectez votre appareil Android à votre ordinateur avec un câble USB.</li>
        <li>Taper <code>cd [project]</code>.</li>
        <li>Lancez la commande <code>flutter install</code>.</li>
      </ol>


    </google-codelab-step>

    <google-codelab-step label="Conclusion" duration="0">
      <p>Merci d&#39;avoir suivi ce tutoriel, j&#39;espère qu&#39;il vous a permis de découvrir les bases de Flutter.
      </p>
      <h2 is-upgraded><strong>Liens utiles</strong></h2>
      <ul>
        <li><a href="https://flutter.dev/" target="_blank">https://flutter.dev/</a></li>
        <li><a href="https://flutter.dev/docs" target="_blank">https://flutter.dev/docs</a></li>
        <li><a href="https://www.ionos.fr/digitalguide/sites-internet/developpement-web/tutoriel-flutter/"
            target="_blank">https://www.ionos.fr/digitalguide/sites-internet/developpement-web/tutoriel-flutter/</a>
        </li>
        <li><a href="https://github.com/GastonDeseineIG2I/LA2-TutorielFlutter/"
            target="_blank">https://github.com/GastonDeseineIG2I/LA2-TutorielFlutter/</a></li>
        <li><a href="http://dourlens-monchy.fr:8091/swagger-ui/#/"
            target="_blank">http://dourlens-monchy.fr:8091/swagger-ui/#/</a></li>
      </ul>


    </google-codelab-step>




  </google-codelab>

  <script async>
    document.addEventListener("DOMContentLoaded", function () {
      var pubBtn = document.getElementById('publishButton');
      var pubForm = document.getElementById('publishForm');
      var pubStatus = document.getElementById('publishButtonStatus');

      pubForm.addEventListener('submit', function (e) {
        e.preventDefault();
        pubBtn.disabled = true;
        pubStatus.textContent = '';
        pubStatus.classList.remove('success');
        pubStatus.classList.remove('error');

        var req = new XMLHttpRequest();

        var onError = function () {
          var msg = 'Request failed';
          if (req.statusText) {
            msg += ' with status "' + req.statusText + '"';
          }
          if (req.responseText) {
            msg += ': ' + req.responseText;
          }
          pubStatus.classList.add('error');
          pubStatus.textContent = msg;
          pubBtn.disabled = false;
        };

        req.addEventListener('load', function () {
          if (req.status != 200) {
            onError();
            return;
          }
          pubStatus.textContent = ('Publication request submitted' +
            ' (reload preview to re-publish)');
          pubStatus.classList.add('success');
        });
        req.addEventListener('error', onError);
        req.addEventListener('abort', onError);
        req.open("post", pubForm.action);
        req.send(new FormData(pubForm));
      });
    });
  </script>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
</body>

</html>